<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FinAssist Widget</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.ico">

</head>

<body>
<div id="launcher" onclick="openChat()">ğŸ’¬</div>
<!-- Floating Chat Widget -->
<div class="chat-widget" id="chatWidget">

    <!-- HEADER -->
    <div class="chat-header">
        <div class="bot-info">
            <div class="bot-icon">ğŸ’°</div>
            <div>
                <div class="bot-name">FinAssist AI</div>
                <div class="bot-status">â— We're online</div>
            </div>
        </div>

        <div class="header-actions">
            <button onclick="refreshChat()">âŸ³</button>
            <button onclick="toggleChat()">âœ•</button>
        </div>
    </div>

    <!-- BODY -->
    <div class="chat-body" id="messages">

        <div class="date">Today</div>

        <div class="bot-bubble">
            Hi there! Nice to see you ğŸ™‚
            We have a finance assistant ready to help you.
        </div>

        <div class="quick-replies">
            <button>Yes, sure!</button>
            <button>No, thanks!</button>
        </div>

        <div class="suggested">What are your most popular financial tips?</div>

    </div>

    <!-- INPUT -->
    <div class="chat-input">
        <button onclick="addEmoji()">ğŸ˜Š</button>
        <button onclick="uploadFile()">ğŸ“</button>
        <input id="input" placeholder="Enter message">
        <button onclick="send()">â¤</button>
    </div>

</div>
</div>

<script>

const backend="https://chat-bot-86is.onrender.com/chat";
const session_id="user_"+Math.floor(Math.random()*10000);

/* Send */
async function send(){
    const input=document.getElementById("input");
    const msg=input.value;
    if(!msg) return;

    addMessage("user",msg);
    input.value="";
    autoScroll();


    const typing = addTyping();

    const res=await fetch(backend,{
        method:"POST",
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({session_id:session_id,message:msg})
    });

    const data=await res.json();
    typing.remove();
    addMessage("bot",data.response);
    autoScroll();
}

/* Add message */
function addMessage(role,text){
    const div=document.createElement("div");
    div.className=role==="user" ? "user-bubble" : "bot-bubble";
    div.innerText=text;
    document.getElementById("messages").appendChild(div);
    return div;
}

function addTyping(){
    const div=document.createElement("div");
    div.className="bot-bubble typing";
    div.innerText="...";
    document.getElementById("messages").appendChild(div);
    return div;
}


/* Auto scroll */
function autoScroll(){
    const box=document.getElementById("messages");
    requestAnimationFrame(()=>{
        box.scrollTop = box.scrollHeight;
    });
}

/* Enter key */
document.getElementById("input").addEventListener("keypress", function(e){
    if(e.key==="Enter"){
        send();
    }
});

/* Refresh */
function refreshChat(){
    document.getElementById("messages").innerHTML="";
}

/* Toggle */
function toggleChat(){
    const widget=document.getElementById("chatWidget");
    widget.style.display="none";
}


function openChat(){
    document.getElementById("chatWidget").style.display="block";
    document.getElementById("launcher").style.display="none";
}

function closeChat(){
    document.getElementById("chatWidget").style.display="none";
    document.getElementById("launcher").style.display="flex";
}






/* Emoji */
function addEmoji(){
    document.getElementById("input").value+="ğŸ˜Š";
}

/* File */
function uploadFile(){
    alert("File upload coming next ğŸš€");
}

</script>

</body>
</html>
